<!doctype html>
<html lang="en" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Animal Classification Game</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
      -webkit-touch-callout: none;
    }
    
    * {
      font-family: 'Fredoka', sans-serif;
    }
    
    /* Improved touch-friendly draggables */
    .draggable {
      cursor: grab;
      touch-action: none;
      user-select: none;
      transition: transform 0.15s ease, box-shadow 0.15s ease;
      -webkit-user-drag: none;
    }
    
    .draggable:active {
      transform: translateY(-2px) scale(1.02);
    }
    
    @media (hover: hover) {
      .draggable:hover {
        transform: translateY(-2px) scale(1.02);
      }
    }
    
    .draggable.dragging {
      cursor: grabbing;
      opacity: 0.9;
      transform: scale(1.05);
      box-shadow: 0 20px 40px rgba(0,0,0,0.2);
      z-index: 1000;
    }
    
    /* Mobile-optimized buckets */
    .bucket {
      transition: all 0.2s ease;
      min-height: 120px;
    }
    
    @media (min-width: 640px) {
      .bucket {
        min-height: 192px;
      }
    }
    
    .bucket.drag-over {
      transform: scale(1.02);
      box-shadow: 0 0 0 4px rgba(255,255,255,0.5);
    }
    
    .bucket.correct-drop {
      animation: correctPulse 0.5s ease;
    }
    
    .bucket.wrong-drop {
      animation: wrongShake 0.4s ease;
    }
    
    @keyframes correctPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.03); }
    }
    
    @keyframes wrongShake {
      0%, 100% { transform: translateX(0); }
      20% { transform: translateX(-8px); }
      40% { transform: translateX(8px); }
      60% { transform: translateX(-8px); }
      80% { transform: translateX(8px); }
    }
    
    @keyframes popIn {
      0% { transform: scale(0); opacity: 0; }
      70% { transform: scale(1.1); }
      100% { transform: scale(1); opacity: 1; }
    }
    
    .pop-in {
      animation: popIn 0.3s ease forwards;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-5px); }
    }
    
    .floating {
      animation: float 2s ease-in-out infinite;
    }
    
    @keyframes confetti {
      0% { transform: translateY(0) rotate(0deg); opacity: 1; }
      100% { transform: translateY(-100px) rotate(720deg); opacity: 0; }
    }
    
    .confetti-piece {
      position: absolute;
      width: 10px;
      height: 10px;
      animation: confetti 1s ease-out forwards;
    }
    
    .progress-fill {
      transition: width 0.5s ease;
    }
    
    @keyframes celebrate {
      0%, 100% { transform: scale(1) rotate(0deg); }
      25% { transform: scale(1.1) rotate(-5deg); }
      75% { transform: scale(1.1) rotate(5deg); }
    }
    
    .celebrate {
      animation: celebrate 0.5s ease infinite;
    }
    
    /* Mobile-specific improvements */
    @media (max-width: 640px) {
      #items-container {
        max-height: 300px;
        overflow-y: auto;
        padding: 8px;
      }
      
      .draggable {
        padding: 12px 16px;
        font-size: 14px;
      }
      
      .bucket h2 {
        font-size: 18px;
      }
      
      .bucket p {
        font-size: 12px;
      }
    }
    
    /* Prevent text selection during drag */
    .no-select {
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }
    
    /* Larger touch targets */
    .touch-target {
      min-width: 44px;
      min-height: 44px;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
</head>
<body class="h-full m-0 overflow-auto no-select">
  <div id="app-wrapper" class="w-full min-h-full" style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);">
    <div class="max-w-6xl mx-auto p-3 md:p-6">
      <!-- Header -->
      <header class="text-center mb-4 md:mb-6">
        <h1 id="game-title" class="text-2xl md:text-4xl font-bold text-white mb-2 drop-shadow-lg">üî¨ Animal Classification Challenge</h1>
        <p id="instruction-text" class="text-sm md:text-lg text-emerald-300 px-2">Drag each animal to its correct classification!</p>
        <p class="text-xs text-white/60 mt-1 md:hidden">Touch & drag animals to categories</p>
      </header>
      
      <!-- Progress Section -->
      <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-3 md:p-4 mb-4 md:mb-6">
        <div class="flex flex-wrap items-center justify-between gap-3">
          <div class="flex items-center gap-3">
            <div class="text-white">
              <span class="text-xs opacity-70">Score</span>
              <div class="text-xl md:text-2xl font-bold text-yellow-400" id="score">0</div>
            </div>
            <div class="text-white">
              <span class="text-xs opacity-70">Streak</span>
              <div class="text-xl md:text-2xl font-bold text-orange-400" id="streak">üî• 0</div>
            </div>
          </div>
          <div class="flex-1 min-w-[150px] max-w-md">
            <div class="flex justify-between text-xs md:text-sm text-white mb-1">
              <span>Progress</span> 
              <span id="progress-text">0 / 20</span>
            </div>
            <div class="h-3 md:h-4 bg-white/20 rounded-full overflow-hidden">
              <div id="progress-bar" class="progress-fill h-full bg-gradient-to-r from-emerald-400 to-cyan-400 rounded-full" style="width: 0%"></div>
            </div>
          </div>
          <button id="reset-btn" class="px-3 md:px-4 py-2 bg-white/20 hover:bg-white/30 text-white rounded-xl transition-all font-medium text-sm md:text-base touch-target">
            üîÑ Reset
          </button>
        </div>
      </div>
      
      <!-- Buckets Grid -->
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3 md:gap-4 mb-4 md:mb-6">
        <!-- Mammals -->
        <div class="bucket rounded-2xl p-3 md:p-4" data-category="mammals" style="background: linear-gradient(145deg, #e94560, #c73e54);">
          <div class="text-center mb-2 md:mb-3">
            <span class="text-3xl md:text-4xl">ü¶Å</span>
            <h2 class="text-lg md:text-xl font-bold text-white mt-1">Mammals</h2>
            <p class="text-xs md:text-sm text-white/70">Warm-blooded, fur/hair, milk</p>
          </div>
          <div class="bucket-items flex flex-wrap gap-1 md:gap-2 justify-center min-h-12 md:min-h-16" id="mammals-bucket"></div>
        </div>
        
        <!-- Reptiles -->
        <div class="bucket rounded-2xl p-3 md:p-4" data-category="reptiles" style="background: linear-gradient(145deg, #0f9b0f, #0d850d);">
          <div class="text-center mb-2 md:mb-3">
            <span class="text-3xl md:text-4xl">ü¶é</span>
            <h2 class="text-lg md:text-xl font-bold text-white mt-1">Reptiles</h2>
            <p class="text-xs md:text-sm text-white/70">Cold-blooded, scales, eggs</p>
          </div>
          <div class="bucket-items flex flex-wrap gap-1 md:gap-2 justify-center min-h-12 md:min-h-16" id="reptiles-bucket"></div>
        </div>
        
        <!-- Amphibians -->
        <div class="bucket rounded-2xl p-3 md:p-4" data-category="amphibians" style="background: linear-gradient(145deg, #3b82f6, #2563eb);">
          <div class="text-center mb-2 md:mb-3">
            <span class="text-3xl md:text-4xl">üê∏</span>
            <h2 class="text-lg md:text-xl font-bold text-white mt-1">Amphibians</h2>
            <p class="text-xs md:text-sm text-white/70">Cold-blooded, moist skin, water/land</p>
          </div>
          <div class="bucket-items flex flex-wrap gap-1 md:gap-2 justify-center min-h-12 md:min-h-16" id="amphibians-bucket"></div>
        </div>
        
        <!-- Birds -->
        <div class="bucket rounded-2xl p-3 md:p-4" data-category="birds" style="background: linear-gradient(145deg, #ffd700, #ffaa00);">
          <div class="text-center mb-2 md:mb-3">
            <span class="text-3xl md:text-4xl">ü¶Ö</span>
            <h2 class="text-lg md:text-xl font-bold text-white mt-1">Birds</h2>
            <p class="text-xs md:text-sm text-white/70">Feathers, beaks, lay eggs</p>
          </div>
          <div class="bucket-items flex flex-wrap gap-1 md:gap-2 justify-center min-h-12 md:min-h-16" id="birds-bucket"></div>
        </div>
        
        <!-- Fish -->
        <div class="bucket rounded-2xl p-3 md:p-4" data-category="fish" style="background: linear-gradient(145deg, #00b4d8, #0077b6);">
          <div class="text-center mb-2 md:mb-3">
            <span class="text-3xl md:text-4xl">üê†</span>
            <h2 class="text-lg md:text-xl font-bold text-white mt-1">Fish</h2>
            <p class="text-xs md:text-sm text-white/70">Gills, scales, live in water</p>
          </div>
          <div class="bucket-items flex flex-wrap gap-1 md:gap-2 justify-center min-h-12 md:min-h-16" id="fish-bucket"></div>
        </div>
        
        <!-- Insects -->
        <div class="bucket rounded-2xl p-3 md:p-4" data-category="insects" style="background: linear-gradient(145deg, #8ac926, #6a994e);">
          <div class="text-center mb-2 md:mb-3">
            <span class="text-3xl md:text-4xl">ü¶ã</span>
            <h2 class="text-lg md:text-xl font-bold text-white mt-1">Insects</h2>
            <p class="text-xs md:text-sm text-white/70">Six legs, exoskeleton, antennae</p>
          </div>
          <div class="bucket-items flex flex-wrap gap-1 md:gap-2 justify-center min-h-12 md:min-h-16" id="insects-bucket"></div>
        </div>
        
        <!-- Arachnids -->
        <div class="bucket rounded-2xl p-3 md:p-4" data-category="arachnids" style="background: linear-gradient(145deg, #7209b7, #560bad);">
          <div class="text-center mb-2 md:mb-3">
            <span class="text-3xl md:text-4xl">üï∑Ô∏è</span>
            <h2 class="text-lg md:text-xl font-bold text-white mt-1">Arachnids</h2>
            <p class="text-xs md:text-sm text-white/70">Eight legs, no antennae</p>
          </div>
          <div class="bucket-items flex flex-wrap gap-1 md:gap-2 justify-center min-h-12 md:min-h-16" id="arachnids-bucket"></div>
        </div>
        
        <!-- Marine Animals -->
        <div class="bucket rounded-2xl p-3 md:p-4" data-category="marine" style="background: linear-gradient(145deg, #0096c7, #023e8a);">
          <div class="text-center mb-2 md:mb-3">
            <span class="text-3xl md:text-4xl">üêô</span>
            <h2 class="text-lg md:text-xl font-bold text-white mt-1">Marine Life</h2>
            <p class="text-xs md:text-sm text-white/70">Ocean creatures, various types</p>
          </div>
          <div class="bucket-items flex flex-wrap gap-1 md:gap-2 justify-center min-h-12 md:min-h-16" id="marine-bucket"></div>
        </div>
      </div>
      
      <!-- Items to Sort -->
      <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-4 md:p-6">
        <h3 class="text-center text-white/70 mb-3 md:mb-4 text-xs md:text-sm font-medium uppercase tracking-wide">Animals to Classify</h3>
        <div id="items-container" class="flex flex-wrap gap-2 md:gap-3 justify-center"></div>
      </div>
      
      <!-- Feedback Toast -->
      <div id="feedback-toast" class="fixed bottom-6 left-1/2 transform -translate-x-1/2 px-4 md:px-6 py-2 md:py-3 rounded-2xl font-bold text-base md:text-lg shadow-2xl transition-all duration-300 opacity-0 translate-y-4 pointer-events-none z-50 max-w-[90vw] text-center"></div>
      
      <!-- Success Modal -->
      <div id="success-modal" class="fixed inset-0 flex items-center justify-center bg-black/50 backdrop-blur-sm opacity-0 pointer-events-none transition-opacity duration-300 z-50">
        <div class="bg-gradient-to-br from-emerald-500 to-cyan-600 rounded-3xl p-6 md:p-8 text-center max-w-md mx-4 transform scale-90 transition-transform duration-300">
          <div class="text-5xl md:text-6xl mb-4 celebrate">üéâ</div>
          <h2 id="success-title" class="text-2xl md:text-3xl font-bold text-white mb-2">Amazing Work!</h2>
          <p class="text-white/90 mb-4 text-sm md:text-base">You've classified all animals correctly!</p>
          <div class="bg-white/20 rounded-xl p-3 md:p-4 mb-4 md:mb-6">
            <div class="text-white text-base md:text-lg">
              Final Score: <span id="final-score" class="font-bold text-yellow-300">0</span>
            </div>
            <div class="text-white/80 text-sm">
              Best Streak: <span id="final-streak">0</span>
            </div>
          </div>
          <button id="play-again-btn" class="px-6 md:px-8 py-3 bg-white text-emerald-600 font-bold rounded-xl hover:bg-emerald-50 transition-all transform hover:scale-105 text-sm md:text-base touch-target">
            üîÑ Play Again
          </button>
        </div>
      </div>
    </div>
  </div>
  <script>
    // Enhanced game data with more categories
    const animals = [
      // Mammals (6)
      { id: 1, name: "Dolphin", emoji: "üê¨", category: "mammals" },
      { id: 2, name: "Bat", emoji: "ü¶á", category: "mammals" },
      { id: 3, name: "Elephant", emoji: "üêò", category: "mammals" },
      { id: 4, name: "Whale", emoji: "üêã", category: "mammals" },
      { id: 5, name: "Kangaroo", emoji: "ü¶ò", category: "mammals" },
      { id: 6, name: "Platypus", emoji: "ü¶Ü", category: "mammals" },
      
      // Reptiles (4)
      { id: 7, name: "Crocodile", emoji: "üêä", category: "reptiles" },
      { id: 8, name: "Turtle", emoji: "üê¢", category: "reptiles" },
      { id: 9, name: "Snake", emoji: "üêç", category: "reptiles" },
      { id: 10, name: "Lizard", emoji: "ü¶é", category: "reptiles" },
      
      // Amphibians (3)
      { id: 11, name: "Frog", emoji: "üê∏", category: "amphibians" },
      { id: 12, name: "Salamander", emoji: "ü¶é", category: "amphibians" },
      { id: 13, name: "Newt", emoji: "ü¶é", category: "amphibians" },
      
      // Birds (4)
      { id: 14, name: "Eagle", emoji: "ü¶Ö", category: "birds" },
      { id: 15, name: "Penguin", emoji: "üêß", category: "birds" },
      { id: 16, name: "Ostrich", emoji: "üê¶", category: "birds" },
      { id: 17, name: "Parrot", emoji: "ü¶ú", category: "birds" },
      
      // Fish (3)
      { id: 18, name: "Shark", emoji: "ü¶à", category: "fish" },
      { id: 19, name: "Clownfish", emoji: "üê†", category: "fish" },
      { id: 20, name: "Goldfish", emoji: "üêü", category: "fish" },
      
      // Insects (3)
      { id: 21, name: "Butterfly", emoji: "ü¶ã", category: "insects" },
      { id: 22, name: "Ant", emoji: "üêú", category: "insects" },
      { id: 23, name: "Bee", emoji: "üêù", category: "insects" },
      
      // Arachnids (2)
      { id: 24, name: "Spider", emoji: "üï∑Ô∏è", category: "arachnids" },
      { id: 25, name: "Scorpion", emoji: "ü¶Ç", category: "arachnids" },
      
      // Marine (2)
      { id: 26, name: "Octopus", emoji: "üêô", category: "marine" },
      { id: 27, name: "Jellyfish", emoji: "üéê", category: "marine" }
    ];

    // Game state
    let gameState = {
      score: 0,
      streak: 0,
      bestStreak: 0,
      sorted: [],
      remaining: [...animals]
    };

    // Mobile detection
    const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
    
    // Improved touch handling variables
    let touchElement = null;
    let touchClone = null;
    let touchOffsetX = 0;
    let touchOffsetY = 0;
    let activeTouches = 0;

    // Shuffle array
    function shuffle(array) {
      const arr = [...array];
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    // Render items with mobile optimization
    function renderItems() {
      const container = document.getElementById('items-container');
      container.innerHTML = '';
      
      const shuffled = shuffle(gameState.remaining);
      
      shuffled.forEach((animal, index) => {
        const item = document.createElement('div');
        item.className = 'draggable bg-white rounded-xl px-3 md:px-4 py-2 md:py-3 shadow-lg flex items-center gap-2 pop-in touch-target';
        item.style.animationDelay = `${index * 0.03}s`;
        item.dataset.id = animal.id;
        item.dataset.category = animal.category;
        item.draggable = true;
        item.innerHTML = `
          <span class="text-xl md:text-2xl">${animal.emoji}</span>
          <span class="font-medium text-gray-800 text-sm md:text-base">${animal.name}</span>
        `;
        
        // Add drag events for desktop
        item.addEventListener('dragstart', handleDragStart);
        item.addEventListener('dragend', handleDragEnd);
        
        // Add touch events for mobile
        item.addEventListener('touchstart', handleTouchStart, { passive: false });
        item.addEventListener('touchmove', handleTouchMove, { passive: false });
        item.addEventListener('touchend', handleTouchEnd);
        item.addEventListener('touchcancel', handleTouchEnd);
        
        container.appendChild(item);
      });
      
      // Add scroll hint on mobile if many items
      if (isMobile && gameState.remaining.length > 8) {
        const scrollHint = document.createElement('div');
        scrollHint.className = 'w-full text-center mt-2 text-white/60 text-xs';
        scrollHint.textContent = '‚Üì Scroll to see more animals ‚Üì';
        container.appendChild(scrollHint);
      }
    }

    // Update progress
    function updateProgress() {
      const total = animals.length;
      const sorted = gameState.sorted.length;
      const percentage = (sorted / total) * 100;
      
      document.getElementById('score').textContent = gameState.score;
      document.getElementById('streak').textContent = `üî• ${gameState.streak}`;
      document.getElementById('progress-text').textContent = `${sorted} / ${total}`;
      document.getElementById('progress-bar').style.width = `${percentage}%`;
      
      if (sorted === total) {
        setTimeout(() => showSuccessModal(), 500);
      }
    }

    // Improved touch handlers for mobile
    function handleTouchStart(e) {
      e.preventDefault();
      if (activeTouches > 0) return; // Ignore multi-touch
      
      const touch = e.touches[0];
      touchElement = e.currentTarget;
      activeTouches = e.touches.length;
      
      const rect = touchElement.getBoundingClientRect();
      touchOffsetX = touch.clientX - rect.left;
      touchOffsetY = touch.clientY - rect.top;
      
      // Create visual feedback for touch
      touchElement.classList.add('dragging');
      touchElement.style.opacity = '0.8';
      
      // Create clone for dragging effect
      touchClone = touchElement.cloneNode(true);
      touchClone.style.position = 'fixed';
      touchClone.style.zIndex = '9999';
      touchClone.style.pointerEvents = 'none';
      touchClone.style.width = `${rect.width}px`;
      touchClone.classList.add('dragging');
      touchClone.style.opacity = '0.9';
      touchClone.style.transform = 'scale(1.1)';
      document.body.appendChild(touchClone);
      
      updateClonePosition(touch.clientX, touch.clientY);
    }

    function handleTouchMove(e) {
      if (!touchClone) return;
      e.preventDefault();
      
      const touch = e.touches[0];
      updateClonePosition(touch.clientX, touch.clientY);
      
      // Check for bucket hover
      const buckets = document.querySelectorAll('.bucket');
      let hoveredBucket = null;
      
      buckets.forEach(bucket => {
        const rect = bucket.getBoundingClientRect();
        if (touch.clientX >= rect.left && touch.clientX <= rect.right &&
            touch.clientY >= rect.top && touch.clientY <= rect.bottom) {
          hoveredBucket = bucket;
          bucket.classList.add('drag-over');
        } else {
          bucket.classList.remove('drag-over');
        }
      });
      
      // Visual feedback for valid drop
      if (hoveredBucket) {
        touchClone.style.boxShadow = '0 0 20px rgba(0,255,0,0.5)';
      } else {
        touchClone.style.boxShadow = '';
      }
    }

    function handleTouchEnd(e) {
      if (!touchElement || !touchClone) return;
      
      const touch = e.changedTouches[0];
      let dropped = false;
      
      // Find bucket under touch
      document.querySelectorAll('.bucket').forEach(bucket => {
        const rect = bucket.getBoundingClientRect();
        if (touch.clientX >= rect.left && touch.clientX <= rect.right &&
            touch.clientY >= rect.top && touch.clientY <= rect.bottom) {
          handleDrop(touchElement.dataset.id, bucket.dataset.category, bucket);
          dropped = true;
        }
        bucket.classList.remove('drag-over');
      });
      
      // If not dropped on bucket, return to original position
      if (!dropped) {
        // Add return animation
        touchClone.style.transition = 'all 0.3s ease';
        const originalRect = touchElement.getBoundingClientRect();
        touchClone.style.left = `${originalRect.left}px`;
        touchClone.style.top = `${originalRect.top}px`;
        touchClone.style.transform = 'scale(1)';
        
        setTimeout(() => {
          if (touchClone) {
            touchClone.remove();
            touchClone = null;
          }
        }, 300);
      } else {
        // Remove clone immediately if dropped
        touchClone.remove();
        touchClone = null;
      }
      
      // Clean up
      if (touchElement) {
        touchElement.classList.remove('dragging');
        touchElement.style.opacity = '1';
        touchElement = null;
      }
      
      activeTouches = 0;
    }

    function updateClonePosition(x, y) {
      if (!touchClone) return;
      touchClone.style.left = `${x - touchOffsetX}px`;
      touchClone.style.top = `${y - touchOffsetY}px`;
    }

    // Desktop drag handlers
    let draggedElement = null;

    function handleDragStart(e) {
      draggedElement = e.target;
      e.target.classList.add('dragging');
      e.dataTransfer.effectAllowed = 'move';
      e.dataTransfer.setData('text/plain', e.target.dataset.id);
    }

    function handleDragEnd(e) {
      e.target.classList.remove('dragging');
      draggedElement = null;
      document.querySelectorAll('.bucket').forEach(b => b.classList.remove('drag-over'));
    }

    // Handle drop
    function handleDrop(itemId, targetCategory, bucketElement) {
      const animal = animals.find(a => a.id === parseInt(itemId));
      if (!animal) return;
      
      const correct = animal.category === targetCategory;
      
      if (correct) {
        // Correct answer
        gameState.score += 10 + gameState.streak * 2;
        gameState.streak++;
        gameState.bestStreak = Math.max(gameState.bestStreak, gameState.streak);
        gameState.sorted.push(animal);
        gameState.remaining = gameState.remaining.filter(a => a.id !== animal.id);
        
        // Add to bucket
        const bucketItems = bucketElement.querySelector('.bucket-items');
        const sortedItem = document.createElement('div');
        sortedItem.className = 'bg-white/20 rounded-lg px-2 md:px-3 py-1 text-white text-xs md:text-sm flex items-center gap-1 pop-in';
        sortedItem.innerHTML = `<span>${animal.emoji}</span><span>${animal.name}</span>`;
        bucketItems.appendChild(sortedItem);
        
        bucketElement.classList.add('correct-drop');
        setTimeout(() => bucketElement.classList.remove('correct-drop'), 500);
        
        createConfetti(bucketElement);
        showFeedback(true, `‚úì Correct! +${10 + (gameState.streak - 1) * 2} points`);
        
        renderItems();
      } else {
        // Wrong answer
        gameState.streak = 0;
        gameState.score = Math.max(0, gameState.score - 5);
        
        bucketElement.classList.add('wrong-drop');
        setTimeout(() => bucketElement.classList.remove('wrong-drop'), 400);
        
        const categoryName = targetCategory === 'arachnids' ? 'arachnid' : targetCategory.slice(0, -1);
        showFeedback(false, `‚úó Try again! ${animal.name} is not a ${categoryName}`);
      }
      
      updateProgress();
    }

    // Show feedback toast
    function showFeedback(correct, message) {
      const toast = document.getElementById('feedback-toast');
      toast.textContent = message;
      toast.className = `fixed bottom-6 left-1/2 transform -translate-x-1/2 px-4 md:px-6 py-2 md:py-3 rounded-2xl font-bold text-base md:text-lg shadow-2xl transition-all duration-300 ${correct ? 'bg-emerald-500 text-white' : 'bg-red-500 text-white'}`;
      toast.style.opacity = '1';
      toast.style.transform = 'translate(-50%, 0)';
      
      setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.transform = 'translate(-50%, 1rem)';
      }, 1500);
    }

    // Create confetti
    function createConfetti(element) {
      const rect = element.getBoundingClientRect();
      const colors = ['#ffd700', '#ff6b6b', '#4ecdc4', '#45b7d1', '#96f97b'];
      
      for (let i = 0; i < 8; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'confetti-piece';
        confetti.style.left = `${rect.left + rect.width / 2 + (Math.random() - 0.5) * 50}px`;
        confetti.style.top = `${rect.top + rect.height / 2}px`;
        confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
        document.body.appendChild(confetti);
        
        setTimeout(() => confetti.remove(), 1000);
      }
    }

    // Setup buckets for desktop
    function setupBuckets() {
      document.querySelectorAll('.bucket').forEach(bucket => {
        bucket.addEventListener('dragover', (e) => {
          e.preventDefault();
          bucket.classList.add('drag-over');
        });
        
        bucket.addEventListener('dragleave', () => {
          bucket.classList.remove('drag-over');
        });
        
        bucket.addEventListener('drop', (e) => {
          e.preventDefault();
          bucket.classList.remove('drag-over');
          const itemId = e.dataTransfer.getData('text/plain');
          if (itemId) {
            handleDrop(itemId, bucket.dataset.category, bucket);
          }
        });
      });
    }

    // Show success modal
    function showSuccessModal() {
      const modal = document.getElementById('success-modal');
      document.getElementById('final-score').textContent = gameState.score;
      document.getElementById('final-streak').textContent = gameState.bestStreak;
      modal.style.opacity = '1';
      modal.style.pointerEvents = 'auto';
      modal.querySelector('div > div:first-of-type').style.transform = 'scale(1)';
      
      // Add celebration confetti
      createConfetti(modal);
    }

    // Reset game
    function resetGame() {
      gameState = {
        score: 0,
        streak: 0,
        bestStreak: 0,
        sorted: [],
        remaining: [...animals]
      };
      
      document.querySelectorAll('.bucket-items').forEach(b => b.innerHTML = '');
      
      const modal = document.getElementById('success-modal');
      modal.style.opacity = '0';
      modal.style.pointerEvents = 'none';
      modal.querySelector('div > div:first-of-type').style.transform = 'scale(0.9)';
      
      renderItems();
      updateProgress();
      
      // Show reset feedback
      showFeedback(true, 'üîÑ Game Reset! Start classifying!');
    }

    // Initialize game
    document.addEventListener('DOMContentLoaded', () => {
      setupBuckets();
      renderItems();
      updateProgress();
      
      document.getElementById('reset-btn').addEventListener('click', resetGame);
      document.getElementById('play-again-btn').addEventListener('click', resetGame);
      
      // Prevent context menu on long press for mobile
      document.addEventListener('contextmenu', (e) => {
        if (isMobile) {
          e.preventDefault();
        }
      });
      
      // Add vibration feedback for mobile if available
      if (isMobile && 'vibrate' in navigator) {
        document.querySelectorAll('.draggable').forEach(item => {
          item.addEventListener('touchstart', () => {
            navigator.vibrate(10);
          });
        });
      }
    });
  </script>
</body>
</html>
