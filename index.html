<!doctype html>
<html lang="en" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Zoology Master: Animal Classification</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&amp;family=Poppins:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #1a1a2e;
      --secondary: #16213e;
      --accent: #0f3460;
      --success: #10b981;
      --danger: #ef4444;
      --warning: #f59e0b;
      --info: #3b82f6;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 50%, var(--accent) 100%);
      color: white;
      overflow-x: hidden;
      user-select: none;
      min-height: 100vh;
    }
    
    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
    }
    
    ::-webkit-scrollbar-thumb {
      background: linear-gradient(45deg, #00b4d8, #0077b6);
      border-radius: 10px;
    }
    
    /* Game container */
    .game-container {
      perspective: 1000px;
      min-height: 100vh;
    }
    
    /* Card flip animations */
    .card {
      transform-style: preserve-3d;
      transition: transform 0.6s;
    }
    
    .card.flipped {
      transform: rotateY(180deg);
    }
    
    .card-front, .card-back {
      backface-visibility: hidden;
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }
    
    .card-back {
      transform: rotateY(180deg);
    }
    
    /* Particle effects */
    .particle {
      position: absolute;
      pointer-events: none;
      z-index: 100;
    }
    
    /* Draggable items with 3D effect */
    .draggable {
      cursor: grab;
      transform-style: preserve-3d;
      transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      border: 2px solid transparent;
      background: linear-gradient(145deg, rgba(255,255,255,0.95), rgba(255,255,255,0.85));
    }
    
    .draggable:hover {
      transform: translateY(-5px) rotateX(5deg);
      box-shadow: 0 15px 25px rgba(0, 0, 0, 0.2);
      border-color: rgba(59, 130, 246, 0.5);
    }
    
    .draggable.dragging {
      cursor: grabbing;
      transform: scale(1.1) rotate(5deg);
      z-index: 1000;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      border-color: #3b82f6;
      animation: float 3s ease-in-out infinite;
    }
    
    /* Bucket styling */
    .bucket {
      transition: all 0.3s ease;
      background: linear-gradient(145deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      transform-style: preserve-3d;
    }
    
    .bucket::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5), transparent);
      border-radius: 4px 4px 0 0;
    }
    
    .bucket.highlight {
      animation: bucketPulse 2s infinite;
      border-color: rgba(59, 130, 246, 0.8);
      box-shadow: 0 0 30px rgba(59, 130, 246, 0.4);
    }
    
    .bucket.valid-drop {
      border-color: #10b981;
      box-shadow: 0 0 20px rgba(16, 185, 129, 0.3);
    }
    
    .bucket.invalid-drop {
      border-color: #ef4444;
      box-shadow: 0 0 20px rgba(239, 68, 68, 0.3);
    }
    
    /* Progress bar with gradient */
    .progress-container {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      overflow: hidden;
      position: relative;
    }
    
    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, #10b981, #3b82f6, #8b5cf6);
      background-size: 200% 100%;
      animation: gradientMove 3s ease infinite;
      position: relative;
      transition: width 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    
    .progress-bar::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      animation: shine 2s infinite;
    }
    
    /* Animations */
    @keyframes float {
      0%, 100% { transform: translateY(0) rotate(5deg); }
      50% { transform: translateY(-10px) rotate(5deg); }
    }
    
    @keyframes bucketPulse {
      0%, 100% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.4); }
      50% { box-shadow: 0 0 40px rgba(59, 130, 246, 0.6); }
    }
    
    @keyframes gradientMove {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }
    
    @keyframes shine {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }
    
    @keyframes popIn {
      0% { opacity: 0; transform: scale(0) rotate(-180deg); }
      70% { transform: scale(1.1) rotate(10deg); }
      100% { opacity: 1; transform: scale(1) rotate(0); }
    }
    
    @keyframes bounceIn {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-15px); }
    }
    
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
      20%, 40%, 60%, 80% { transform: translateX(5px); }
    }
    
    /* Notification system */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(10px);
      border-left: 4px solid;
      padding: 15px 20px;
      border-radius: 8px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      transform: translateX(150%);
      transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      z-index: 10000;
    }
    
    .notification.show {
      transform: translateX(0);
    }
    
    /* Tooltip */
    .tooltip {
      position: relative;
    }
    
    .tooltip:hover::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 12px;
      white-space: nowrap;
      z-index: 1000;
      margin-bottom: 5px;
    }
    
    /* Glow effects */
    .glow {
      animation: glowPulse 2s infinite alternate;
    }
    
    @keyframes glowPulse {
      from { box-shadow: 0 0 10px rgba(59, 130, 246, 0.5); }
      to { box-shadow: 0 0 25px rgba(59, 130, 246, 0.8); }
    }
    
    /* Particle trails */
    .trail {
      position: absolute;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      pointer-events: none;
      z-index: 9999;
    }
    
    /* Mobile optimizations */
    @media (max-width: 768px) {
      .draggable {
        padding: 12px 15px !important;
        font-size: 14px !important;
      }
      
      .bucket {
        padding: 15px !important;
      }
      
      .bucket h3 {
        font-size: 18px !important;
      }
      
      .game-stats {
        flex-direction: column;
        gap: 15px;
      }
      
      .controls {
        flex-wrap: wrap;
      }
    }
    
    /* Loading animation */
    .loader {
      width: 50px;
      height: 50px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: #3b82f6;
      animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Achievements */
    .achievement {
      background: linear-gradient(45deg, rgba(255,215,0,0.2), rgba(255,165,0,0.2));
      border: 2px solid gold;
      border-radius: 10px;
      padding: 10px;
      margin: 5px;
      text-align: center;
    }
    
    /* Score multiplier animation */
    .multiplier {
      animation: multiplierPop 0.5s ease-out;
    }
    
    @keyframes multiplierPop {
      0% { transform: scale(0); opacity: 0; }
      70% { transform: scale(1.3); }
      100% { transform: scale(1); opacity: 1; }
    }
  </style>
</head>
<body class="h-full">
  <!-- Loading Screen -->
  <div id="loading-screen" class="fixed inset-0 flex flex-col items-center justify-center bg-gradient-to-br from-indigo-900 to-purple-900 z-50 transition-opacity duration-500">
    <div class="loader mb-6"></div>
    <h2 class="text-2xl font-bold mb-2">Loading Zoology Master...</h2>
    <p class="text-gray-300">Preparing animal kingdom for classification</p>
    <div class="w-64 h-2 bg-white/20 rounded-full mt-6 overflow-hidden">
      <div id="loading-progress" class="h-full bg-gradient-to-r from-emerald-400 to-cyan-400 transition-all duration-300" style="width: 0%"></div>
    </div>
  </div>

  <!-- Main Game Container -->
  <div id="game-container" class="game-container min-h-screen hidden">
    <!-- Background Particles -->
    <div id="particles-container" class="fixed inset-0 pointer-events-none z-0"></div>
    
    <!-- Header -->
    <header class="relative z-10 py-6 px-4 md:px-8">
      <div class="max-w-7xl mx-auto">
        <div class="flex flex-col md:flex-row justify-between items-center gap-6">
          <div class="text-center md:text-left">
            <h1 class="text-3xl md:text-4xl font-bold bg-gradient-to-r from-emerald-400 to-cyan-400 bg-clip-text text-transparent">
              <i class="fas fa-microscope mr-3"></i>Zoology Master
            </h1>
            <p class="text-gray-300 mt-2">Animal Classification Challenge</p>
          </div>
          
          <div class="flex items-center gap-4">
            <div class="relative group">
              <button id="settings-btn" class="p-3 rounded-full bg-white/10 hover:bg-white/20 transition-all tooltip" data-tooltip="Settings">
                <i class="fas fa-cog text-xl"></i>
              </button>
            </div>
            <div class="relative group">
              <button id="sound-toggle" class="p-3 rounded-full bg-white/10 hover:bg-white/20 transition-all tooltip" data-tooltip="Sound On/Off">
                <i class="fas fa-volume-up text-xl"></i>
              </button>
            </div>
            <div class="relative group">
              <button id="help-btn" class="p-3 rounded-full bg-white/10 hover:bg-white/20 transition-all tooltip" data-tooltip="Help">
                <i class="fas fa-question text-xl"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Main Game Area -->
    <main class="relative z-10 py-6 px-4 md:px-8">
      <div class="max-w-7xl mx-auto">
        <!-- Game Stats -->
        <div class="game-stats bg-white/5 backdrop-blur-lg rounded-2xl p-6 mb-8 border border-white/10">
          <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
            <!-- Score -->
            <div class="text-center p-4 rounded-xl bg-gradient-to-br from-emerald-500/20 to-emerald-600/20">
              <div class="text-sm text-gray-300 mb-1">SCORE</div>
              <div id="score" class="text-3xl md:text-4xl font-bold text-emerald-400">0</div>
              <div class="text-xs text-gray-400 mt-1">Points</div>
            </div>
            
            <!-- Streak -->
            <div class="text-center p-4 rounded-xl bg-gradient-to-br from-orange-500/20 to-orange-600/20">
              <div class="text-sm text-gray-300 mb-1">STREAK</div>
              <div id="streak" class="text-3xl md:text-4xl font-bold text-orange-400">üî•0</div>
              <div id="multiplier" class="text-sm text-yellow-400 font-bold mt-1">x1</div>
            </div>
            
            <!-- Timer -->
            <div class="text-center p-4 rounded-xl bg-gradient-to-br from-blue-500/20 to-blue-600/20">
              <div class="text-sm text-gray-300 mb-1">TIME</div>
              <div id="timer" class="text-3xl md:text-4xl font-bold text-blue-400">02:00</div>
              <div class="text-xs text-gray-400 mt-1">Remaining</div>
            </div>
            
            <!-- Progress -->
            <div class="text-center p-4 rounded-xl bg-gradient-to-br from-purple-500/20 to-purple-600/20">
              <div class="text-sm text-gray-300 mb-1">PROGRESS</div>
              <div id="progress-text" class="text-3xl md:text-4xl font-bold text-purple-400">0/25</div>
              <div class="text-xs text-gray-400 mt-1">Animals Classified</div>
            </div>
          </div>
          
          <!-- Progress Bar -->
          <div class="mt-6">
            <div class="flex justify-between text-sm text-gray-300 mb-2">
              <span>Classification Progress</span>
              <span id="progress-percent">0%</span>
            </div>
            <div class="progress-container h-4 rounded-full">
              <div id="progress-bar" class="progress-bar rounded-full" style="width: 0%"></div>
            </div>
          </div>
        </div>

        <!-- Difficulty Selector -->
        <div class="controls flex flex-wrap gap-4 mb-8 justify-center">
          <button data-difficulty="easy" class="difficulty-btn px-6 py-3 rounded-xl bg-emerald-600 hover:bg-emerald-700 font-medium transition-all">
            <i class="fas fa-seedling mr-2"></i>Easy
          </button>
          <button data-difficulty="medium" class="difficulty-btn px-6 py-3 rounded-xl bg-blue-600 hover:bg-blue-700 font-medium transition-all active">
            <i class="fas fa-tree mr-2"></i>Medium
          </button>
          <button data-difficulty="hard" class="difficulty-btn px-6 py-3 rounded-xl bg-red-600 hover:bg-red-700 font-medium transition-all">
            <i class="fas fa-fire mr-2"></i>Hard
          </button>
          <button data-difficulty="expert" class="difficulty-btn px-6 py-3 rounded-xl bg-purple-600 hover:bg-purple-700 font-medium transition-all">
            <i class="fas fa-crown mr-2"></i>Expert
          </button>
        </div>

        <!-- Categories Grid -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-8">
          <!-- Categories will be dynamically generated -->
        </div>

        <!-- Draggable Animals -->
        <div class="bg-white/5 backdrop-blur-lg rounded-2xl p-6 border border-white/10">
          <div class="flex justify-between items-center mb-6">
            <h3 class="text-xl font-bold">
              <i class="fas fa-paw mr-2"></i>Animals to Classify
              <span id="remaining-count" class="ml-2 text-emerald-400">(25)</span>
            </h3>
            <button id="shuffle-btn" class="px-4 py-2 bg-white/10 hover:bg-white/20 rounded-lg transition-all tooltip" data-tooltip="Shuffle Animals">
              <i class="fas fa-random mr-2"></i>Shuffle
            </button>
          </div>
          <div id="items-container" class="flex flex-wrap gap-4 justify-center"></div>
        </div>

        <!-- Hint Section -->
        <div id="hint-section" class="mt-6 p-4 bg-gradient-to-r from-blue-900/30 to-purple-900/30 rounded-xl border border-blue-500/30 hidden">
          <div class="flex items-center">
            <i class="fas fa-lightbulb text-2xl text-yellow-400 mr-3"></i>
            <div>
              <p id="hint-text" class="font-medium"></p>
              <p class="text-sm text-gray-400 mt-1">Hint will appear here when you're stuck</p>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Audio Elements -->
    <audio id="correct-sound" preload="auto">
      <source src="https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3" type="audio/mpeg">
    </audio>
    <audio id="wrong-sound" preload="auto">
      <source src="https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3" type="audio/mpeg">
    </audio>
    <audio id="drop-sound" preload="auto">
      <source src="https://assets.mixkit.co/sfx/preview/mixkit-select-click-1109.mp3" type="audio/mpeg">
    </audio>
    <audio id="background-music" loop preload="auto">
      <source src="https://assets.mixkit.co/music/preview/mixkit-game-show-suspense-waiting-667.mp3" type="audio/mpeg">
    </audio>
  </div>

  <!-- Settings Modal -->
  <div id="settings-modal" class="fixed inset-0 flex items-center justify-center bg-black/70 backdrop-blur-sm z-50 hidden">
    <div class="bg-gradient-to-br from-gray-900 to-gray-800 rounded-3xl p-8 max-w-md w-full mx-4 border border-white/10">
      <div class="flex justify-between items-center mb-6">
        <h3 class="text-2xl font-bold">Settings</h3>
        <button id="close-settings" class="p-2 hover:bg-white/10 rounded-lg">
          <i class="fas fa-times text-xl"></i>
        </button>
      </div>
      
      <div class="space-y-6">
        <div>
          <h4 class="font-medium mb-3">Audio Settings</h4>
          <div class="space-y-4">
            <div class="flex items-center justify-between">
              <span>Background Music</span>
              <div class="relative">
                <input type="checkbox" id="music-toggle" class="sr-only" checked>
                <label for="music-toggle" class="toggle-switch"></label>
              </div>
            </div>
            <div class="flex items-center justify-between">
              <span>Sound Effects</span>
              <div class="relative">
                <input type="checkbox" id="sfx-toggle" class="sr-only" checked>
                <label for="sfx-toggle" class="toggle-switch"></label>
              </div>
            </div>
          </div>
        </div>
        
        <div>
          <h4 class="font-medium mb-3">Game Settings</h4>
          <div class="space-y-4">
            <div>
              <label class="block mb-2">Time Limit (minutes)</label>
              <input type="range" id="time-limit" min="1" max="10" value="2" class="w-full">
              <div class="text-center mt-1"><span id="time-value">2</span> minutes</div>
            </div>
            <div>
              <label class="block mb-2">Animations</label>
              <div class="relative">
                <input type="checkbox" id="animations-toggle" class="sr-only" checked>
                <label for="animations-toggle" class="toggle-switch"></label>
              </div>
            </div>
          </div>
        </div>
        
        <button id="save-settings" class="w-full py-3 bg-gradient-to-r from-emerald-500 to-cyan-500 rounded-xl font-bold hover:opacity-90 transition-all">
          Save Settings
        </button>
      </div>
    </div>
  </div>

  <!-- Game Over Modal -->
  <div id="game-over-modal" class="fixed inset-0 flex items-center justify-center bg-black/80 backdrop-blur-sm z-50 hidden">
    <div class="bg-gradient-to-br from-gray-900 to-gray-800 rounded-3xl p-8 max-w-2xl w-full mx-4 border border-white/10">
      <div class="text-center">
        <div class="text-6xl mb-4">üèÜ</div>
        <h2 id="result-title" class="text-3xl font-bold mb-2">Game Completed!</h2>
        <p class="text-gray-300 mb-8">You've mastered the animal kingdom!</p>
        
        <div class="grid grid-cols-2 gap-6 mb-8">
          <div class="bg-white/5 p-6 rounded-xl">
            <div class="text-sm text-gray-400 mb-2">Final Score</div>
            <div id="final-score" class="text-4xl font-bold text-emerald-400">0</div>
          </div>
          <div class="bg-white/5 p-6 rounded-xl">
            <div class="text-sm text-gray-400 mb-2">Best Streak</div>
            <div id="final-streak" class="text-4xl font-bold text-orange-400">0</div>
          </div>
          <div class="bg-white/5 p-6 rounded-xl">
            <div class="text-sm text-gray-400 mb-2">Time Bonus</div>
            <div id="time-bonus" class="text-4xl font-bold text-blue-400">+0</div>
          </div>
          <div class="bg-white/5 p-6 rounded-xl">
            <div class="text-sm text-gray-400 mb-2">Accuracy</div>
            <div id="accuracy" class="text-4xl font-bold text-purple-400">100%</div>
          </div>
        </div>
        
        <div class="space-y-4">
          <button id="play-again-btn" class="w-full py-4 bg-gradient-to-r from-emerald-500 to-cyan-500 rounded-xl font-bold text-lg hover:opacity-90 transition-all">
            <i class="fas fa-redo mr-2"></i>Play Again
          </button>
          <button id="share-score" class="w-full py-4 bg-gradient-to-r from-blue-500 to-purple-500 rounded-xl font-bold text-lg hover:opacity-90 transition-all">
            <i class="fas fa-share-alt mr-2"></i>Share Score
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Notification Container -->
  <div id="notification-container"></div>

  <script>
    // Advanced Game Data
    const gameData = {
      categories: {
        mammals: {
          name: "Mammals",
          emoji: "ü¶Å",
          color: "#e94560",
          description: "Warm-blooded vertebrates with hair/fur, mammary glands",
          examples: ["Humans", "Dogs", "Whales", "Bats"]
        },
        reptiles: {
          name: "Reptiles",
          emoji: "üêä",
          color: "#0f9b0f",
          description: "Cold-blooded vertebrates with scales, lay eggs",
          examples: ["Snakes", "Lizards", "Turtles", "Crocodiles"]
        },
        amphibians: {
          name: "Amphibians",
          emoji: "üê∏",
          color: "#3b82f6",
          description: "Cold-blooded, live in water and land, moist skin",
          examples: ["Frogs", "Toads", "Salamanders", "Newts"]
        },
        birds: {
          name: "Birds",
          emoji: "ü¶Ö",
          color: "#ffd700",
          description: "Feathers, beaks, lay eggs, most can fly",
          examples: ["Eagles", "Penguins", "Owls", "Hummingbirds"]
        },
        fish: {
          name: "Fish",
          emoji: "üê†",
          color: "#00b4d8",
          description: "Aquatic vertebrates with gills and fins",
          examples: ["Sharks", "Goldfish", "Salmon", "Clownfish"]
        },
        insects: {
          name: "Insects",
          emoji: "ü¶ã",
          color: "#8ac926",
          description: "Six legs, exoskeleton, three-part body",
          examples: ["Butterflies", "Ants", "Bees", "Beetles"]
        },
        arachnids: {
          name: "Arachnids",
          emoji: "üï∑Ô∏è",
          color: "#7209b7",
          description: "Eight legs, two body segments, no antennae",
          examples: ["Spiders", "Scorpions", "Ticks", "Mites"]
        },
        marine: {
          name: "Marine Life",
          emoji: "üêô",
          color: "#0096c7",
          description: "Various ocean-dwelling creatures",
          examples: ["Octopus", "Jellyfish", "Starfish", "Corals"]
        },
        marsupials: {
          name: "Marsupials",
          emoji: "ü¶ò",
          color: "#ff6b6b",
          description: "Carry young in pouches",
          examples: ["Kangaroos", "Koalas", "Wallabies", "Wombats"]
        },
        primates: {
          name: "Primates",
          emoji: "üôä",
          color: "#ff9e00",
          description: "Large brains, forward-facing eyes, grasping hands",
          examples: ["Monkeys", "Apes", "Lemurs", "Humans"]
        }
      },
      
      animals: [
        // Mammals
        { id: 1, name: "Dolphin", emoji: "üê¨", category: "mammals", difficulty: 1 },
        { id: 2, name: "Bat", emoji: "ü¶á", category: "mammals", difficulty: 2 },
        { id: 3, name: "Elephant", emoji: "üêò", category: "mammals", difficulty: 1 },
        { id: 4, name: "Blue Whale", emoji: "üêã", category: "mammals", difficulty: 3 },
        { id: 5, name: "Platypus", emoji: "ü¶Ü", category: "mammals", difficulty: 3 },
        
        // Reptiles
        { id: 6, name: "Komodo Dragon", emoji: "üêâ", category: "reptiles", difficulty: 3 },
        { id: 7, name: "Sea Turtle", emoji: "üê¢", category: "reptiles", difficulty: 2 },
        { id: 8, name: "King Cobra", emoji: "üêç", category: "reptiles", difficulty: 3 },
        { id: 9, name: "Chameleon", emoji: "ü¶é", category: "reptiles", difficulty: 2 },
        { id: 10, name: "Alligator", emoji: "üêä", category: "reptiles", difficulty: 2 },
        
        // Amphibians
        { id: 11, name: "Poison Dart Frog", emoji: "üê∏", category: "amphibians", difficulty: 3 },
        { id: 12, name: "Axolotl", emoji: "ü¶é", category: "amphibians", difficulty: 3 },
        { id: 13, name: "Salamander", emoji: "ü¶é", category: "amphibians", difficulty: 2 },
        { id: 14, name: "Newt", emoji: "ü¶é", category: "amphibians", difficulty: 2 },
        
        // Birds
        { id: 15, name: "Bald Eagle", emoji: "ü¶Ö", category: "birds", difficulty: 1 },
        { id: 16, name: "Penguin", emoji: "üêß", category: "birds", difficulty: 1 },
        { id: 17, name: "Ostrich", emoji: "ü¶©", category: "birds", difficulty: 2 },
        { id: 18, name: "Hummingbird", emoji: "üê¶", category: "birds", difficulty: 2 },
        
        // Fish
        { id: 19, name: "Great White Shark", emoji: "ü¶à", category: "fish", difficulty: 2 },
        { id: 20, name: "Clownfish", emoji: "üê†", category: "fish", difficulty: 1 },
        { id: 21, name: "Pufferfish", emoji: "üê°", category: "fish", difficulty: 2 },
        
        // Insects
        { id: 22, name: "Monarch Butterfly", emoji: "ü¶ã", category: "insects", difficulty: 1 },
        { id: 23, name: "Honey Bee", emoji: "üêù", category: "insects", difficulty: 1 },
        { id: 24, name: "Ladybug", emoji: "üêû", category: "insects", difficulty: 1 },
        
        // Arachnids
        { id: 25, name: "Black Widow", emoji: "üï∑Ô∏è", category: "arachnids", difficulty: 3 },
        { id: 26, name: "Scorpion", emoji: "ü¶Ç", category: "arachnids", difficulty: 2 },
        
        // Marine
        { id: 27, name: "Giant Squid", emoji: "üêô", category: "marine", difficulty: 3 },
        { id: 28, name: "Jellyfish", emoji: "üéê", category: "marine", difficulty: 2 },
        { id: 29, name: "Starfish", emoji: "‚≠ê", category: "marine", difficulty: 1 },
        
        // Marsupials
        { id: 30, name: "Kangaroo", emoji: "ü¶ò", category: "marsupials", difficulty: 1 },
        { id: 31, name: "Koala", emoji: "üê®", category: "marsupials", difficulty: 1 },
        
        // Primates
        { id: 32, name: "Gorilla", emoji: "ü¶ç", category: "primates", difficulty: 2 },
        { id: 33, name: "Orangutan", emoji: "ü¶ß", category: "primates", difficulty: 2 },
        { id: 34, name: "Lemur", emoji: "üêí", category: "primates", difficulty: 2 }
      ],
      
      difficulties: {
        easy: { animals: 12, time: 180, categories: 4, multiplier: 1 },
        medium: { animals: 20, time: 120, categories: 6, multiplier: 1.5 },
        hard: { animals: 25, time: 90, categories: 8, multiplier: 2 },
        expert: { animals: 30, time: 60, categories: 10, multiplier: 3 }
      }
    };

    // Game State
    const gameState = {
      score: 0,
      streak: 0,
      bestStreak: 0,
      totalCorrect: 0,
      totalAttempts: 0,
      timeLeft: 120,
      timerInterval: null,
      isPlaying: false,
      currentDifficulty: 'medium',
      selectedAnimals: [],
      sortedAnimals: [],
      categories: [],
      settings: {
        sound: true,
        music: true,
        animations: true,
        timeLimit: 120
      },
      achievements: {
        perfectGame: false,
        speedRun: false,
        streakMaster: false
      }
    };

    // DOM Elements
    const elements = {
      loadingScreen: document.getElementById('loading-screen'),
      gameContainer: document.getElementById('game-container'),
      score: document.getElementById('score'),
      streak: document.getElementById('streak'),
      timer: document.getElementById('timer'),
      progressText: document.getElementById('progress-text'),
      progressBar: document.getElementById('progress-bar'),
      progressPercent: document.getElementById('progress-percent'),
      itemsContainer: document.getElementById('items-container'),
      remainingCount: document.getElementById('remaining-count'),
      categoriesGrid: document.querySelector('.categories-grid'),
      settingsModal: document.getElementById('settings-modal'),
      gameOverModal: document.getElementById('game-over-modal'),
      hintSection: document.getElementById('hint-section'),
      hintText: document.getElementById('hint-text')
    };

    // Audio Elements
    const audio = {
      correct: document.getElementById('correct-sound'),
      wrong: document.getElementById('wrong-sound'),
      drop: document.getElementById('drop-sound'),
      background: document.getElementById('background-music')
    };

    // Initialize Particles
    function initParticles() {
      const container = document.getElementById('particles-container');
      for (let i = 0; i < 50; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        particle.style.width = `${Math.random() * 5 + 2}px`;
        particle.style.height = particle.style.width;
        particle.style.background = `radial-gradient(circle, rgba(59,130,246,${Math.random() * 0.5 + 0.2}) 0%, transparent 70%)`;
        particle.style.left = `${Math.random() * 100}vw`;
        particle.style.top = `${Math.random() * 100}vh`;
        
        // Animate particle
        particle.animate([
          { transform: 'translate(0, 0)' },
          { transform: `translate(${Math.random() * 100 - 50}px, ${Math.random() * 100 - 50}px)` }
        ], {
          duration: Math.random() * 3000 + 2000,
          iterations: Infinity,
          direction: 'alternate'
        });
        
        container.appendChild(particle);
      }
    }

    // Show Notification
    function showNotification(message, type = 'info') {
      const container = document.getElementById('notification-container');
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      
      const icons = {
        success: '‚úÖ',
        error: '‚ùå',
        warning: '‚ö†Ô∏è',
        info: '‚ÑπÔ∏è'
      };
      
      notification.innerHTML = `
        <div class="flex items-center">
          <span class="text-xl mr-3">${icons[type] || icons.info}</span>
          <span>${message}</span>
        </div>
      `;
      
      container.appendChild(notification);
      
      // Show notification
      setTimeout(() => notification.classList.add('show'), 10);
      
      // Remove after delay
      setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => notification.remove(), 500);
      }, 3000);
    }

    // Play Sound
    function playSound(sound) {
      if (!gameState.settings.sound) return;
      
      try {
        sound.currentTime = 0;
        sound.play().catch(e => console.log("Audio play failed:", e));
      } catch (e) {
        console.log("Audio error:", e);
      }
    }

    // Create Trail Effect
    function createTrail(x, y, color = '#3b82f6') {
      if (!gameState.settings.animations) return;
      
      const trail = document.createElement('div');
      trail.className = 'trail';
      trail.style.left = `${x}px`;
      trail.style.top = `${y}px`;
      trail.style.background = color;
      trail.style.opacity = '0.7';
      
      document.body.appendChild(trail);
      
      // Animate trail
      trail.animate([
        { transform: 'scale(1)', opacity: 0.7 },
        { transform: 'scale(0)', opacity: 0 }
      ], {
        duration: 500,
        easing: 'ease-out'
      });
      
      setTimeout(() => trail.remove(), 500);
    }

    // Create Confetti
    function createConfetti(x, y) {
      if (!gameState.settings.animations) return;
      
      const colors = ['#ef4444', '#f59e0b', '#10b981', '#3b82f6', '#8b5cf6'];
      
      for (let i = 0; i < 15; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'particle';
        confetti.style.width = '15px';
        confetti.style.height = '15px';
        confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
        confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
        confetti.style.left = `${x}px`;
        confetti.style.top = `${y}px`;
        
        document.body.appendChild(confetti);
        
        // Random animation
        const angle = Math.random() * Math.PI * 2;
        const distance = 100 + Math.random() * 100;
        const duration = 1000 + Math.random() * 1000;
        
        confetti.animate([
          { transform: 'translate(0, 0) rotate(0deg)', opacity: 1 },
          { transform: `translate(${Math.cos(angle) * distance}px, ${Math.sin(angle) * distance}px) rotate(${Math.random() * 720}deg)`, opacity: 0 }
        ], {
          duration,
          easing: 'cubic-bezier(0.215, 0.610, 0.355, 1)'
        });
        
        setTimeout(() => confetti.remove(), duration);
      }
    }

    // Shuffle Array
    function shuffleArray(array) {
      const arr = [...array];
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    // Start Game
    function startGame(difficulty) {
      gameState.currentDifficulty = difficulty;
      gameState.score = 0;
      gameState.streak = 0;
      gameState.totalCorrect = 0;
      gameState.totalAttempts = 0;
      gameState.timeLeft = gameData.difficulties[difficulty].time;
      gameState.selectedAnimals = [];
      gameState.sortedAnimals = [];
      gameState.categories = [];
      gameState.isPlaying = true;
      
      // Select animals based on difficulty
      const diffConfig = gameData.difficulties[difficulty];
      const availableAnimals = gameData.animals.filter(a => a.difficulty <= (difficulty === 'expert' ? 3 : difficulty === 'hard' ? 3 : difficulty === 'medium' ? 2 : 1));
      gameState.selectedAnimals = shuffleArray(availableAnimals).slice(0, diffConfig.animals);
      
      // Select categories based on selected animals
      const uniqueCategories = [...new Set(gameState.selectedAnimals.map(a => a.category))];
      gameState.categories = shuffleArray(uniqueCategories).slice(0, diffConfig.categories);
      
      // Initialize UI
      updateScore();
      updateTimer();
      renderCategories();
      renderAnimals();
      startTimer();
      
      // Play background music
      if (gameState.settings.music) {
        audio.background.volume = 0.3;
        audio.background.play().catch(e => console.log("Music play failed"));
      }
      
      showNotification(`Starting ${difficulty.charAt(0).toUpperCase() + difficulty.slice(1)} Mode!`, 'info');
    }

    // Render Categories
    function renderCategories() {
      const grid = document.querySelector('.grid.grid-cols-1');
      grid.innerHTML = '';
      
      gameState.categories.forEach(categoryId => {
        const category = gameData.categories[categoryId];
        const bucket = document.createElement('div');
        bucket.className = 'bucket rounded-2xl p-5 transition-all duration-300';
        bucket.dataset.category = categoryId;
        bucket.style.background = `linear-gradient(145deg, ${category.color}40, ${category.color}20)`;
        bucket.style.borderColor = `${category.color}60`;
        
        bucket.innerHTML = `
          <div class="text-center mb-4">
            <div class="text-5xl mb-3">${category.emoji}</div>
            <h3 class="text-xl font-bold mb-2">${category.name}</h3>
            <p class="text-sm opacity-80 mb-3">${category.description}</p>
            <div class="flex flex-wrap gap-2 justify-center text-xs">
              ${category.examples.slice(0, 2).map(ex => `<span class="px-2 py-1 rounded-full bg-white/10">${ex}</span>`).join('')}
            </div>
          </div>
          <div class="bucket-items flex flex-wrap gap-2 justify-center min-h-16" id="${categoryId}-bucket"></div>
        `;
        
        // Add drag and drop events
        bucket.addEventListener('dragover', handleDragOver);
        bucket.addEventListener('dragleave', handleDragLeave);
        bucket.addEventListener('drop', handleDrop);
        
        grid.appendChild(bucket);
      });
    }

    // Render Animals
    function renderAnimals() {
      const container = document.getElementById('items-container');
      container.innerHTML = '';
      
      const shuffledAnimals = shuffleArray(gameState.selectedAnimals.filter(a => !gameState.sortedAnimals.includes(a.id)));
      
      shuffledAnimals.forEach((animal, index) => {
        const item = document.createElement('div');
        item.className = 'draggable rounded-xl px-5 py-4 flex items-center gap-3 shadow-lg pop-in';
        item.dataset.id = animal.id;
        item.dataset.category = animal.category;
        item.draggable = true;
        
        // Add difficulty indicator
        const difficultyStars = '‚òÖ'.repeat(animal.difficulty) + '‚òÜ'.repeat(3 - animal.difficulty);
        
        item.innerHTML = `
          <div class="text-3xl">${animal.emoji}</div>
          <div>
            <div class="font-bold text-gray-800">${animal.name}</div>
            <div class="text-xs text-gray-600 mt-1">${difficultyStars}</div>
          </div>
        `;
        
        // Add drag events
        item.addEventListener('dragstart', handleDragStart);
        item.addEventListener('dragend', handleDragEnd);
        item.addEventListener('touchstart', handleTouchStart, { passive: false });
        item.addEventListener('touchmove', handleTouchMove, { passive: false });
        item.addEventListener('touchend', handleTouchEnd);
        
        // Add mouse events for desktop hover
        item.addEventListener('mouseenter', () => {
          if (!item.classList.contains('dragging')) {
            item.style.transform = 'translateY(-5px) rotateX(5deg)';
          }
        });
        
        item.addEventListener('mouseleave', () => {
          if (!item.classList.contains('dragging')) {
            item.style.transform = '';
          }
        });
        
        container.appendChild(item);
      });
      
      // Update remaining count
      const remaining = gameState.selectedAnimals.length - gameState.sortedAnimals.length;
      elements.remainingCount.textContent = `(${remaining})`;
      
      // Show hint if stuck
      if (remaining > 0 && remaining <= 3) {
        showHint();
      }
    }

    // Show Hint
    function showHint() {
      const remainingAnimals = gameState.selectedAnimals.filter(a => !gameState.sortedAnimals.includes(a.id));
      if (remainingAnimals.length === 0) return;
      
      const randomAnimal = remainingAnimals[Math.floor(Math.random() * remainingAnimals.length)];
      const category = gameData.categories[randomAnimal.category];
      
      elements.hintText.textContent = `Hint: ${randomAnimal.name} belongs to the ${category.name} category. ${category.description}`;
      elements.hintSection.classList.remove('hidden');
      
      // Auto-hide after 10 seconds
      setTimeout(() => {
        elements.hintSection.classList.add('hidden');
      }, 10000);
    }

    // Drag and Drop Handlers
    let draggedElement = null;
    let touchElement = null;
    let touchClone = null;

    function handleDragStart(e) {
      draggedElement = e.target;
      draggedElement.classList.add('dragging');
      e.dataTransfer.effectAllowed = 'move';
      e.dataTransfer.setData('text/plain', e.target.dataset.id);
      
      if (gameState.settings.animations) {
        createTrail(e.clientX, e.clientY);
      }
    }

    function handleDragEnd(e) {
      if (draggedElement) {
        draggedElement.classList.remove('dragging');
        draggedElement.style.transform = '';
      }
      
      // Remove all drag-over classes
      document.querySelectorAll('.bucket').forEach(b => {
        b.classList.remove('drag-over', 'valid-drop', 'invalid-drop');
      });
      
      draggedElement = null;
    }

    function handleDragOver(e) {
      e.preventDefault();
      const bucket = e.currentTarget;
      
      if (draggedElement) {
        const animalCategory = draggedElement.dataset.category;
        const bucketCategory = bucket.dataset.category;
        
        bucket.classList.add('drag-over');
        
        if (animalCategory === bucketCategory) {
          bucket.classList.add('valid-drop');
          bucket.classList.remove('invalid-drop');
        } else {
          bucket.classList.add('invalid-drop');
          bucket.classList.remove('valid-drop');
        }
      }
    }

    function handleDragLeave(e) {
      const bucket = e.currentTarget;
      bucket.classList.remove('drag-over', 'valid-drop', 'invalid-drop');
    }

    function handleDrop(e) {
      e.preventDefault();
      const bucket = e.currentTarget;
      const animalId = e.dataTransfer.getData('text/plain');
      
      handleAnimalDrop(animalId, bucket.dataset.category, bucket);
      
      bucket.classList.remove('drag-over', 'valid-drop', 'invalid-drop');
    }

    // Touch Handlers for Mobile
    function handleTouchStart(e) {
      e.preventDefault();
      touchElement = e.target.closest('.draggable');
      if (!touchElement) return;
      
      touchElement.classList.add('dragging');
      
      // Create visual feedback
      touchClone = touchElement.cloneNode(true);
      touchClone.style.position = 'fixed';
      touchClone.style.zIndex = '10000';
      touchClone.style.pointerEvents = 'none';
      touchClone.classList.add('dragging');
      document.body.appendChild(touchClone);
      
      updateTouchClonePosition(e.touches[0]);
    }

    function handleTouchMove(e) {
      e.preventDefault();
      if (!touchClone) return;
      
      updateTouchClonePosition(e.touches[0]);
      
      // Check bucket hover
      const touch = e.touches[0];
      document.querySelectorAll('.bucket').forEach(bucket => {
        const rect = bucket.getBoundingClientRect();
        if (touch.clientX >= rect.left && touch.clientX <= rect.right &&
            touch.clientY >= rect.top && touch.clientY <= rect.bottom) {
          bucket.classList.add('drag-over');
          
          const animalCategory = touchElement.dataset.category;
          const bucketCategory = bucket.dataset.category;
          
          if (animalCategory === bucketCategory) {
            bucket.classList.add('valid-drop');
          } else {
            bucket.classList.remove('valid-drop');
          }
        } else {
          bucket.classList.remove('drag-over', 'valid-drop');
        }
      });
    }

    function handleTouchEnd(e) {
      if (!touchElement || !touchClone) return;
      
      const touch = e.changedTouches[0];
      let dropped = false;
      
      // Check if dropped on a bucket
      document.querySelectorAll('.bucket').forEach(bucket => {
        const rect = bucket.getBoundingClientRect();
        if (touch.clientX >= rect.left && touch.clientX <= rect.right &&
            touch.clientY >= rect.top && touch.clientY <= rect.bottom) {
          handleAnimalDrop(touchElement.dataset.id, bucket.dataset.category, bucket);
          dropped = true;
        }
        bucket.classList.remove('drag-over', 'valid-drop');
      });
      
      // Clean up
      touchElement.classList.remove('dragging');
      touchClone.remove();
      touchElement = null;
      touchClone = null;
      
      // If not dropped on bucket, play drop sound
      if (!dropped) {
        playSound(audio.drop);
      }
    }

    function updateTouchClonePosition(touch) {
      if (!touchClone) return;
      touchClone.style.left = `${touch.clientX - touchClone.offsetWidth / 2}px`;
      touchClone.style.top = `${touch.clientY - touchClone.offsetHeight / 2}px`;
    }

    // Handle Animal Drop
    function handleAnimalDrop(animalId, targetCategory, bucketElement) {
      gameState.totalAttempts++;
      
      const animal = gameData.animals.find(a => a.id === parseInt(animalId));
      if (!animal) return;
      
      const isCorrect = animal.category === targetCategory;
      
      if (isCorrect) {
        // Correct answer
        gameState.totalCorrect++;
        gameState.streak++;
        gameState.bestStreak = Math.max(gameState.bestStreak, gameState.streak);
        
        // Calculate score with multiplier
        const difficultyMultiplier = gameData.difficulties[gameState.currentDifficulty].multiplier;
        const streakMultiplier = Math.min(5, Math.floor(gameState.streak / 5) + 1);
        const timeBonus = Math.ceil(gameState.timeLeft / 10);
        
        const points = Math.round((10 * difficultyMultiplier * streakMultiplier) + timeBonus);
        gameState.score += points;
        
        // Add to sorted list
        gameState.sortedAnimals.push(animal.id);
        
        // Add to bucket
        const bucketItems = bucketElement.querySelector('.bucket-items');
        const sortedItem = document.createElement('div');
        sortedItem.className = 'bg-white/20 rounded-lg px-3 py-2 flex items-center gap-2 pop-in';
        sortedItem.innerHTML = `<span class="text-lg">${animal.emoji}</span><span class="font-medium">${animal.name}</span>`;
        bucketItems.appendChild(sortedItem);
        
        // Visual feedback
        bucketElement.style.animation = 'none';
        setTimeout(() => {
          bucketElement.style.animation = 'correctPulse 0.6s ease';
        }, 10);
        
        // Create confetti
        const rect = bucketElement.getBoundingClientRect();
        createConfetti(rect.left + rect.width / 2, rect.top + rect.height / 2);
        
        // Play sound
        playSound(audio.correct);
        
        // Show notification
        showNotification(`Correct! +${points} points! üî• Streak: ${gameState.streak}`, 'success');
        
        // Update multiplier display
        const multiplierEl = document.getElementById('multiplier');
        multiplierEl.textContent = `x${streakMultiplier}`;
        multiplierEl.classList.add('multiplier');
        setTimeout(() => multiplierEl.classList.remove('multiplier'), 500);
        
        // Update UI
        updateScore();
        renderAnimals();
        
        // Check for achievements
        checkAchievements();
        
      } else {
        // Wrong answer
        gameState.streak = 0;
        gameState.score = Math.max(0, gameState.score - 10);
        
        // Visual feedback
        bucketElement.style.animation = 'none';
        setTimeout(() => {
          bucketElement.style.animation = 'shake 0.5s ease';
        }, 10);
        
        // Play sound
        playSound(audio.wrong);
        
        // Show notification
        const correctCategory = gameData.categories[animal.category];
        showNotification(`Try again! ${animal.name} is a ${correctCategory.name.toLowerCase()}`, 'error');
        
        // Update UI
        updateScore();
      }
      
      // Update progress
      updateProgress();
      
      // Check if game is complete
      if (gameState.sortedAnimals.length === gameState.selectedAnimals.length) {
        endGame(true);
      }
    }

    // Update Score Display
    function updateScore() {
      elements.score.textContent = gameState.score;
      elements.streak.textContent = `üî•${gameState.streak}`;
    }

    // Update Progress
    function updateProgress() {
      const total = gameState.selectedAnimals.length;
      const sorted = gameState.sortedAnimals.length;
      const percentage = (sorted / total) * 100;
      
      elements.progressText.textContent = `${sorted}/${total}`;
      elements.progressPercent.textContent = `${Math.round(percentage)}%`;
      elements.progressBar.style.width = `${percentage}%`;
    }

    // Start Timer
    function startTimer() {
      if (gameState.timerInterval) {
        clearInterval(gameState.timerInterval);
      }
      
      gameState.timerInterval = setInterval(() => {
        gameState.timeLeft--;
        updateTimer();
        
        if (gameState.timeLeft <= 0) {
          endGame(false);
        }
        
        // Warning when time is running low
        if (gameState.timeLeft === 30) {
          showNotification("30 seconds remaining! ‚è∞", "warning");
        }
      }, 1000);
    }

    // Update Timer Display
    function updateTimer() {
      const minutes = Math.floor(gameState.timeLeft / 60);
      const seconds = gameState.timeLeft % 60;
      elements.timer.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
      
      // Change color when time is low
      if (gameState.timeLeft <= 30) {
        elements.timer.style.color = '#ef4444';
      } else if (gameState.timeLeft <= 60) {
        elements.timer.style.color = '#f59e0b';
      } else {
        elements.timer.style.color = '#3b82f6';
      }
    }

    // Check Achievements
    function checkAchievements() {
      if (gameState.streak >= 10 && !gameState.achievements.streakMaster) {
        gameState.achievements.streakMaster = true;
        showNotification("üèÜ Achievement Unlocked: Streak Master!", "success");
      }
    }

    // End Game
    function endGame(isCompleted) {
      gameState.isPlaying = false;
      clearInterval(gameState.timerInterval);
      
      // Stop background music
      audio.background.pause();
      audio.background.currentTime = 0;
      
      // Calculate final score with time bonus
      const timeBonus = isCompleted ? Math.floor(gameState.timeLeft * 2) : 0;
      const finalScore = gameState.score + timeBonus;
      const accuracy = gameState.totalAttempts > 0 ? Math.round((gameState.totalCorrect / gameState.totalAttempts) * 100) : 0;
      
      // Update modal
      document.getElementById('final-score').textContent = finalScore;
      document.getElementById('final-streak').textContent = gameState.bestStreak;
      document.getElementById('time-bonus').textContent = `+${timeBonus}`;
      document.getElementById('accuracy').textContent = `${accuracy}%`;
      
      if (isCompleted) {
        document.getElementById('result-title').textContent = "Mission Accomplished!";
        
        // Check for perfect game
        if (accuracy === 100) {
          gameState.achievements.perfectGame = true;
          showNotification("üéØ Perfect Game! 100% Accuracy!", "success");
        }
        
        // Check for speed run
        if (gameState.timeLeft >= gameData.difficulties[gameState.currentDifficulty].time * 0.5) {
          gameState.achievements.speedRun = true;
          showNotification("‚ö° Speed Run Bonus!", "success");
        }
      } else {
        document.getElementById('result-title').textContent = "Time's Up!";
      }
      
      // Show game over modal
      setTimeout(() => {
        elements.gameOverModal.classList.remove('hidden');
      }, 1000);
      
      // Create celebration confetti
      createConfetti(window.innerWidth / 2, window.innerHeight / 2);
    }

    // Initialize Settings Toggles
    function initSettings() {
      // Load saved settings
      const savedSettings = localStorage.getItem('zoologyMasterSettings');
      if (savedSettings) {
        gameState.settings = { ...gameState.settings, ...JSON.parse(savedSettings) };
      }
      
      // Update toggle switches
      document.getElementById('music-toggle').checked = gameState.settings.music;
      document.getElementById('sfx-toggle').checked = gameState.settings.sound;
      document.getElementById('animations-toggle').checked = gameState.settings.animations;
      document.getElementById('time-limit').value = gameState.settings.timeLimit / 60;
      document.getElementById('time-value').textContent = gameState.settings.timeLimit / 60;
      
      // Add toggle switch styling
      const style = document.createElement('style');
      style.textContent = `
        .toggle-switch {
          display: inline-block;
          width: 60px;
          height: 30px;
          background: rgba(255,255,255,0.2);
          border-radius: 30px;
          position: relative;
          cursor: pointer;
          transition: background 0.3s;
        }
        
        .toggle-switch::after {
          content: '';
          position: absolute;
          top: 3px;
          left: 3px;
          width: 24px;
          height: 24px;
          background: white;
          border-radius: 50%;
          transition: transform 0.3s;
        }
        
        input:checked + .toggle-switch {
          background: #10b981;
        }
        
        input:checked + .toggle-switch::after {
          transform: translateX(30px);
        }
      `;
      document.head.appendChild(style);
    }

    // Event Listeners
    function initEventListeners() {
      // Difficulty buttons
      document.querySelectorAll('.difficulty-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.difficulty-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          startGame(btn.dataset.difficulty);
        });
      });
      
      // Settings button
      document.getElementById('settings-btn').addEventListener('click', () => {
        elements.settingsModal.classList.remove('hidden');
      });
      
      // Close settings
      document.getElementById('close-settings').addEventListener('click', () => {
        elements.settingsModal.classList.add('hidden');
      });
      
      // Save settings
      document.getElementById('save-settings').addEventListener('click', () => {
        gameState.settings.music = document.getElementById('music-toggle').checked;
        gameState.settings.sound = document.getElementById('sfx-toggle').checked;
        gameState.settings.animations = document.getElementById('animations-toggle').checked;
        gameState.settings.timeLimit = parseInt(document.getElementById('time-limit').value) * 60;
        
        // Save to localStorage
        localStorage.setItem('zoologyMasterSettings', JSON.stringify(gameState.settings));
        
        elements.settingsModal.classList.add('hidden');
        showNotification('Settings saved!', 'success');
      });
      
      // Time limit slider
      document.getElementById('time-limit').addEventListener('input', (e) => {
        document.getElementById('time-value').textContent = e.target.value;
      });
      
      // Sound toggle
      document.getElementById('sound-toggle').addEventListener('click', () => {
        gameState.settings.sound = !gameState.settings.sound;
        const icon = document.getElementById('sound-toggle').querySelector('i');
        icon.className = gameState.settings.sound ? 'fas fa-volume-up' : 'fas fa-volume-mute';
        showNotification(gameState.settings.sound ? 'Sound ON' : 'Sound OFF', 'info');
      });
      
      // Shuffle button
      document.getElementById('shuffle-btn').addEventListener('click', () => {
        renderAnimals();
        playSound(audio.drop);
        showNotification('Animals shuffled!', 'info');
      });
      
      // Play again button
      document.getElementById('play-again-btn').addEventListener('click', () => {
        elements.gameOverModal.classList.add('hidden');
        startGame(gameState.currentDifficulty);
      });
      
      // Share score button
      document.getElementById('share-score').addEventListener('click', () => {
        const score = gameState.score;
        const streak = gameState.bestStreak;
        const message = `üèÜ I scored ${score} points with a streak of ${streak} in Zoology Master! Can you beat me?`;
        
        if (navigator.share) {
          navigator.share({
            title: 'Zoology Master Score',
            text: message,
            url: window.location.href
          });
        } else {
          navigator.clipboard.writeText(message);
          showNotification('Score copied to clipboard!', 'success');
        }
      });
      
      // Help button
      document.getElementById('help-btn').addEventListener('click', () => {
        showNotification('Drag animals to their correct categories. Longer streaks give more points!', 'info');
      });
      
      // Prevent default drag behavior
      document.addEventListener('dragover', (e) => e.preventDefault());
      document.addEventListener('drop', (e) => e.preventDefault());
    }

    // Initialize Game
    function initGame() {
      // Simulate loading
      let progress = 0;
      const loadingInterval = setInterval(() => {
        progress += Math.random() * 15;
        if (progress >= 100) {
          progress = 100;
          clearInterval(loadingInterval);
          
          // Hide loading screen and show game
          setTimeout(() => {
            elements.loadingScreen.style.opacity = '0';
            setTimeout(() => {
              elements.loadingScreen.style.display = 'none';
              elements.gameContainer.classList.remove('hidden');
              
              // Initialize everything
              initParticles();
              initSettings();
              initEventListeners();
              startGame('medium');
            }, 500);
          }, 300);
        }
        
        document.getElementById('loading-progress').style.width = `${progress}%`;
      }, 100);
    }

    // Start the game when page loads
    window.addEventListener('DOMContentLoaded', initGame);
    
    // Add touch event listeners for mobile
    document.addEventListener('touchmove', (e) => {
      if (touchClone && gameState.settings.animations) {
        const touch = e.touches[0];
        createTrail(touch.clientX, touch.clientY, '#3b82f6');
      }
    }, { passive: false });
  </script>
</body>
</html>
